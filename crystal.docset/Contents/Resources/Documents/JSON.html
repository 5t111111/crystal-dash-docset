<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-4389"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/JSON%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>JSON - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> JSON

</h1>





  <h2>Overview</h2>

  <p>The JSON module allows parsing and generating <a href="http://json.org/" target="_blank">JSON</a> documents.</p>

<h3>Parsing and generating with <code><a href="JSON.html#mapping-macro">JSON#mapping</a></code>
</h3>

<p>Use <code><a href="JSON.html#mapping-macro">JSON#mapping</a></code> to define how an object is mapped to JSON, making it
the recommended easy, type-safe and efficient option for parsing and generating
JSON. Refer to that module&#39;s documentation to learn about it.</p>

<h3>Parsing with <code><a href="JSON.html#parse%28input%3AString%7CIO%29%3AAny-class-method">JSON#parse</a></code>
</h3>

<p><code><a href="JSON.html#parse%28input%3AString%7CIO%29%3AAny-class-method">JSON#parse</a></code> will return an <code><a href="JSON/Any.html">Any</a></code>, which is a convenient wrapper around all possible JSON types,
making it easy to traverse a complex JSON structure but requires some casts from time to time,
mostly via some method invocations.</p>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

value <span class="o">=</span> <span class="t">JSON</span>.parse(<span class="s">&#34;[1, 2, 3]&#34;</span>) <span class="c"># : JSON::Any</span>

value[<span class="n">0</span>]              <span class="c"># =&gt; 1</span>
<span class="k">typeof</span>(value[<span class="n">0</span>])      <span class="c"># =&gt; JSON::Any</span>
value[<span class="n">0</span>].as_i         <span class="c"># =&gt; 1</span>
<span class="k">typeof</span>(value[<span class="n">0</span>].as_i) <span class="c"># =&gt; Int32</span>

value[<span class="n">0</span>] <span class="o">+</span> <span class="n">1</span>       <span class="c"># Error, because value[0] is JSON::Any</span>
value[<span class="n">0</span>].as_i <span class="o">+</span> <span class="n">10</span> <span class="c"># =&gt; 11</span></code></pre>

<p>The above is useful for dealing with a dynamic JSON structure but is slower than using <code><a href="JSON.html#mapping-macro">JSON#mapping</a></code>.</p>

<h3>Generating with <code><a href="JSON.html#build%28io%3AIO%2Cindent%3Dnil%2C%26block%29-class-method">JSON.build</a></code>
</h3>

<p>Use <code><a href="JSON.html#build%28io%3AIO%2Cindent%3Dnil%2C%26block%29-class-method">JSON.build</a></code>, which uses <code><a href="JSON/Builder.html">JSON::Builder</a></code>, to generate JSON
by emitting scalars, arrays and objects:</p>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

string <span class="o">=</span> <span class="t">JSON</span>.build <span class="k">do</span> <span class="o">|</span>json<span class="o">|</span>
  json.object <span class="k">do</span>
    json.field <span class="s">&#34;name&#34;</span>, <span class="s">&#34;foo&#34;</span>
    json.field <span class="s">&#34;values&#34;</span> <span class="k">do</span>
      json.array <span class="k">do</span>
        json.number <span class="n">1</span>
        json.number <span class="n">2</span>
        json.number <span class="n">3</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
string <span class="c"># =&gt; %&lt;{&#34;name&#34;:&#34;foo&#34;,&#34;values&#34;:[1,2,3]}&gt;</span></code></pre>

<h3>Generating with <code>to_json</code>
</h3>

<p><code>to_json</code>, <code>to_json(<a href="IO.html">IO</a>)</code> and <code>to_json(<a href="JSON/Builder.html">JSON::Builder</a>)</code> methods are provided
for primitive types, but you need to define <code>to_json(<a href="JSON/Builder.html">JSON::Builder</a>)</code>
for custom objects, either manually or using <code><a href="JSON.html#mapping-macro">JSON#mapping</a></code>.</p>














  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json.cr#L59" target="_blank">json.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/builder.cr#L335" target="_blank">json/builder.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/mapping.cr#L1" target="_blank">json/mapping.cr</a>
    
    <br/>
  







  <h2>Class Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#build%28io%3AIO%2Cindent%3Dnil%2C%26block%29-class-method" class="signature"><strong>.build</strong>(io : IO, indent = <span class="n">nil</span>, &amp;block)</a>
        
          <div class="summary"><p>Writes JSON into the given <code><a href="IO.html">IO</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#build%28indent%3Dnil%2C%26block%29-class-method" class="signature"><strong>.build</strong>(indent = <span class="n">nil</span>, &amp;block)</a>
        
          <div class="summary"><p>Returns the resulting <code><a href="String.html">String</a></code> of writing JSON to the yielded <code><a href="JSON/Builder.html">JSON::Builder</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#parse%28input%3AString%7CIO%29%3AAny-class-method" class="signature"><strong>.parse</strong>(input : String | IO) : Any</a>
        
          <div class="summary"><p>Parses a JSON document as a <code><a href="JSON/Any.html">JSON::Any</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#parse_raw%28input%3AString%7CIO%29%3AType-class-method" class="signature"><strong>.parse_raw</strong>(input : String | IO) : Type</a>
        
          <div class="summary"><p>Parses a JSON document as a <code><a href="JSON/Type.html">JSON::Type</a></code>.</p></div>
        
      </li>
    
  </ul>





  <h2>Macro Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#mapping%28_properties_%2Cstrict%3Dfalse%29-macro" class="signature"><strong>mapping</strong>(_properties_, strict = false)</a>
        
          <div class="summary"><p>The <code><a href="JSON.html#mapping-macro">JSON.mapping</a></code> macro defines how an object is mapped to JSON.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#mapping-macro" class="signature"><strong>mapping</strong></a>
        
          <div class="summary"><p>This is a convenience method to allow invoking <code><a href="JSON.html#mapping-macro">JSON.mapping</a></code> with named arguments instead of with a hash/named-tuple literal.</p></div>
        
      </li>
    
  </ul>



<div class="methods-inherited">
  
</div>




  <h2>Class Method Detail</h2>
  
    <div class="entry-detail" id="build(io:IO,indent=nil,&amp;block)-class-method">
      <a class="dashingAutolink" name="autolink-4383"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.build%28io%20%3A%20IO%2C%20indent%20%3D%20nil%2C%20%26block%29"></a><div class="signature">
        
        def self.<strong>build</strong>(io : <a href="IO.html">IO</a>, indent = <span class="n">nil</span>, &amp;block)

        
      </div>
      
        <div class="doc"><p>Writes JSON into the given <code><a href="IO.html">IO</a></code>. A <code><a href="JSON/Builder.html">JSON::Builder</a></code> is yielded to the block.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/builder.cr#L364" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="build(indent=nil,&amp;block)-class-method">
      <a class="dashingAutolink" name="autolink-4384"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.build%28indent%20%3D%20nil%2C%20%26block%29"></a><div class="signature">
        
        def self.<strong>build</strong>(indent = <span class="n">nil</span>, &amp;block)

        
      </div>
      
        <div class="doc">
<p>Returns the resulting <code><a href="String.html">String</a></code> of writing JSON to the yielded <code><a href="JSON/Builder.html">JSON::Builder</a></code>.</p>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

string <span class="o">=</span> <span class="t">JSON</span>.build <span class="k">do</span> <span class="o">|</span>json<span class="o">|</span>
  json.object <span class="k">do</span>
    json.field <span class="s">&#34;name&#34;</span>, <span class="s">&#34;foo&#34;</span>
    json.field <span class="s">&#34;values&#34;</span> <span class="k">do</span>
      json.array <span class="k">do</span>
        json.number <span class="n">1</span>
        json.number <span class="n">2</span>
        json.number <span class="n">3</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
string <span class="c"># =&gt; %&lt;{&#34;name&#34;:&#34;foo&#34;,&#34;values&#34;:[1,2,3]}&gt;</span></code></pre>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/builder.cr#L355" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="parse(input:String|IO):Any-class-method">
      <a class="dashingAutolink" name="autolink-4385"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.parse%28input%20%3A%20String%20%7C%20IO%29%20%3A%20Any"></a><div class="signature">
        
        def self.<strong>parse</strong>(input : <a href="String.html">String</a> | <a href="IO.html">IO</a>) : <a href="JSON/Any.html">Any</a>

        
      </div>
      
        <div class="doc"><p>Parses a JSON document as a <code><a href="JSON/Any.html">JSON::Any</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json.cr#L82" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="parse_raw(input:String|IO):Type-class-method">
      <a class="dashingAutolink" name="autolink-4386"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.parse_raw%28input%20%3A%20String%20%7C%20IO%29%20%3A%20Type"></a><div class="signature">
        
        def self.<strong>parse_raw</strong>(input : <a href="String.html">String</a> | <a href="IO.html">IO</a>) : <a href="JSON/Type.html">Type</a>

        
      </div>
      
        <div class="doc"><p>Parses a JSON document as a <code><a href="JSON/Type.html">JSON::Type</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json.cr#L87" target="_blank">View source</a>]
        
      </div>
    </div>
  





  <h2>Macro Detail</h2>
  
    <div class="entry-detail" id="mapping(_properties_,strict=false)-macro">
      <a class="dashingAutolink" name="autolink-4387"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/macro%20mapping%28_properties_%2C%20strict%20%3D%20false%29"></a><div class="signature">
        
        macro <strong>mapping</strong>(_properties_, strict = false)

        
      </div>
      
        <div class="doc">
<p>The <code><a href="JSON.html#mapping-macro">JSON.mapping</a></code> macro defines how an object is mapped to JSON.</p>

<h3>Example</h3>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

<span class="k">class</span> <span class="t">Location</span>
  <span class="t">JSON</span>.mapping(
    lat: <span class="t">Float64</span>,
    lng: <span class="t">Float64</span>,
  )
<span class="k">end</span>

<span class="k">class</span> <span class="t">House</span>
  <span class="t">JSON</span>.mapping(
    address: <span class="t">String</span>,
    location: {<span class="k">type</span>: <span class="t">Location</span>, nilable: <span class="n">true</span>},
  )
<span class="k">end</span>

house <span class="o">=</span> <span class="t">House</span>.from_json(<span class="s">%({&#34;address&#34;: &#34;Crystal Road 1234&#34;, &#34;location&#34;: {&#34;lat&#34;: 12.3, &#34;lng&#34;: 34.5}})</span>)
house.address  <span class="c"># =&gt; &#34;Crystal Road 1234&#34;</span>
house.location <span class="c"># =&gt; #&lt;Location:0x10cd93d80 @lat=12.3, @lng=34.5&gt;</span>
house.to_json  <span class="c"># =&gt; %({&#34;address&#34;:&#34;Crystal Road 1234&#34;,&#34;location&#34;:{&#34;lat&#34;:12.3,&#34;lng&#34;:34.5}})</span></code></pre>

<h3>Usage</h3>

<p><code><a href="JSON.html#mapping-macro">JSON.mapping</a></code> must receive a series of named arguments, or a named tuple literal, or a hash literal,
whose keys will define Crystal properties.</p>

<p>The value of each key can be a single type (not a union type). Primitive types (numbers, string, boolean and nil)
are supported, as well as custom objects which use <code><a href="JSON.html#mapping-macro">JSON.mapping</a></code> or define a <code>new</code> method
that accepts a <code><a href="JSON/PullParser.html">JSON::PullParser</a></code> and returns an object from it.</p>

<p>The value can also be another hash literal with the following options:</p>

<ul>
<li>
<strong>type</strong>: (required) the single type described above (you can use <code><a href="JSON/Any.html">JSON::Any</a></code> too)</li>
<li>
<strong>key</strong>: the property name in the JSON document (as opposed to the property name in the Crystal code)</li>
<li>
<strong>nilable</strong>: if <code>true</code>, the property can be <code><a href="Nil.html">Nil</a></code>. Passing <code>T?</code> as a type has the same effect.</li>
<li>
<strong>default</strong>: value to use if the property is missing in the JSON document, or if it&#39;s <code>null</code> and <code>nilable</code> was not set to <code>true</code>. If the default value creates a new instance of an object (for example <code>[1, 2, 3]</code> or <code>SomeObject.new</code>), a different instance will be used each time a JSON document is parsed.</li>
<li>
<strong>emit_null</strong>: if <code>true</code>, emits a <code>null</code> value for nilable properties (by default nulls are not emitted)</li>
<li>
<strong>converter</strong>: specify an alternate type for parsing and generation. The converter must define <code>from_json(<a href="JSON/PullParser.html">JSON::PullParser</a>)</code> and <code>to_json(value, <a href="JSON/Builder.html">JSON::Builder</a>)</code> as class methods. Examples of converters are <code><a href="Time/Format.html">Time::Format</a></code> and <code><a href="Time/EpochConverter.html">Time::EpochConverter</a></code> for <code><a href="Time.html">Time</a></code>.</li>
<li>
<strong>root</strong>: assume the value is inside a JSON object with a given key (see <code>Object.from_json(string_or_io, root)</code>)</li>
<li>
<strong>setter</strong>: if <code>true</code>, will generate a setter for the variable, <code>true</code> by default</li>
<li>
<strong>getter</strong>: if <code>true</code>, will generate a getter for the variable, <code>true</code> by default</li>
<li>
<strong>presence</strong>: if <code>true</code>, a <code>{{key}}_present?</code> method will be generated when the key was present (even if it has a <code>null</code> value), <code>false</code> by default</li>
</ul>

<p>This macro by default defines getters and setters for each variable (this can be overrided with <em>setter</em> and <em>getter</em>).
The mapping doesn&#39;t define a constructor accepting these variables as arguments, but you can provide an overload.</p>

<p>The macro basically defines a constructor accepting a <code><a href="JSON/PullParser.html">JSON::PullParser</a></code> that reads from
it and initializes this type&#39;s instance variables. It also defines a <code>to_json(<a href="JSON/Builder.html">JSON::Builder</a>)</code> method
by invoking <code>to_json(<a href="JSON/Builder.html">JSON::Builder</a>)</code> on each of the properties (unless a converter is specified, in
which case <code>to_json(value, <a href="JSON/Builder.html">JSON::Builder</a>)</code> is invoked).</p>

<p>This macro also declares instance variables of the types given in the mapping.</p>

<p>If <em>strict</em> is <code>true</code>, unknown properties in the JSON
document will raise a parse exception. The default is <code>false</code>, so unknown properties
are silently ignored.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/mapping.cr#L63" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="mapping-macro">
      <a class="dashingAutolink" name="autolink-4388"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/macro%20mapping"></a><div class="signature">
        
        macro <strong>mapping</strong>

        
      </div>
      
        <div class="doc"><p>This is a convenience method to allow invoking <code><a href="JSON.html#mapping-macro">JSON.mapping</a></code>
with named arguments instead of with a hash/named-tuple literal.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/json/mapping.cr#L219" target="_blank">View source</a>]
        
      </div>
    </div>
  


</div>



</body></html>