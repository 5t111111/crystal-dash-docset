<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-2793"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/JSON%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>JSON - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> JSON

</h1>





  <h2>Overview</h2>

  <p>The JSON module allows parsing and generating <a href="http://json.org/" target="_blank">JSON</a> documents.</p>

<h3>Parsing and generating with <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON#mapping</a></code>
</h3>

<p>Use <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON#mapping</a></code> to define how an object is mapped to JSON, making it
the recommended easy, type-safe and efficient option for parsing and generating
JSON. Refer to that module&#39;s documentation to learn about it.</p>

<h3>Parsing with <code><a href="JSON.html#parse%28input%3AString%7CIO%29%3AAny-class-method">JSON#parse</a></code>
</h3>

<p><code><a href="JSON.html#parse%28input%3AString%7CIO%29%3AAny-class-method">JSON#parse</a></code> will return an <code><a href="JSON/Any.html">Any</a></code>, which is a convenient wrapper around all possible JSON types,
making it easy to traverse a complex JSON structure but requires some casts from time to time,
mostly via some method invocations.</p>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

value <span class="o">=</span> <span class="t">JSON</span>.parse(<span class="s">&#34;[1, 2, 3]&#34;</span>) <span class="c"># : JSON::Any</span>

value[<span class="n">0</span>]              <span class="c"># =&gt; 1</span>
<span class="k">typeof</span>(value[<span class="n">0</span>])      <span class="c"># =&gt; JSON::Any</span>
value[<span class="n">0</span>].as_i         <span class="c"># =&gt; 1</span>
<span class="k">typeof</span>(value[<span class="n">0</span>].as_i) <span class="c"># =&gt; Int32</span>

value[<span class="n">0</span>] <span class="o">+</span> <span class="n">1</span>       <span class="c"># Error, because value[0] is JSON::Any</span>
value[<span class="n">0</span>].as_i <span class="o">+</span> <span class="n">10</span> <span class="c"># =&gt; 11</span></code></pre>

<p>The above is useful for dealing with a dynamic JSON structure but is slower than using <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON#mapping</a></code>.</p>

<h3>Generating with <code><a href="JSON/Builder.html">JSON::Builder</a></code>
</h3>

<p>Use <code><a href="JSON/Builder.html">JSON::Builder</a></code> to generate JSON on the fly by directly emitting data
to an <code><a href="IO.html">IO</a></code>.</p>

<h3>Generating with <code>to_json</code>
</h3>

<p><code>to_json</code> and <code>to_json(<a href="IO.html">IO</a>)</code> methods are provided for primitive types, but you
need to define <code>to_json(<a href="IO.html">IO</a>)</code> for custom objects, either manually or using
<code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON#mapping</a></code>.</p>














  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/bbf7c350dcb11e8906631fb62ac87fb965b23f4d/src/json/json.cr" target="_blank">json/json.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/bbf7c350dcb11e8906631fb62ac87fb965b23f4d/src/json/mapping.cr" target="_blank">json/mapping.cr</a>
    
    <br/>
  





  <h2>Class Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#parse%28input%3AString%7CIO%29%3AAny-class-method" class="signature"><strong>.parse</strong>(input : String | IO) : Any</a>
        
          <div class="summary"><p>Parses a JSON document as a <code><a href="JSON/Any.html">JSON::Any</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#parse_raw%28input%3AString%7CIO%29%3AType-class-method" class="signature"><strong>.parse_raw</strong>(input : String | IO) : Type</a>
        
          <div class="summary"><p>Parses a JSON document as a <code><a href="JSON/Type.html">JSON::Type</a></code>.</p></div>
        
      </li>
    
  </ul>





  <h2>Macro Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#mapping%28properties%2Cstrict%3Dfalse%29-macro" class="signature"><strong>mapping</strong>(properties, strict = false)</a>
        
          <div class="summary"><p>The <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON.mapping</a></code> macro defines how an object is mapped to JSON.</p></div>
        
      </li>
    
  </ul>



<div class="methods-inherited">
  
</div>


  <h2>Class Method Detail</h2>
  
    <div class="entry-detail" id="parse(input:String|IO):Any-class-method">
      <a class="dashingAutolink" name="autolink-2794"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.parse%28input%20%3A%20String%20%7C%20IO%29%20%3A%20Any"></a><div class="signature">
        
        def self.<strong>parse</strong>(input : <a href="String.html">String</a> | <a href="IO.html">IO</a>) : <a href="JSON/Any.html">Any</a>

        
      </div>
      
        <div class="doc"><p>Parses a JSON document as a <code><a href="JSON/Any.html">JSON::Any</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/bbf7c350dcb11e8906631fb62ac87fb965b23f4d/src/json/json.cr#L56" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="parse_raw(input:String|IO):Type-class-method">
      <a class="dashingAutolink" name="autolink-2795"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.parse_raw%28input%20%3A%20String%20%7C%20IO%29%20%3A%20Type"></a><div class="signature">
        
        def self.<strong>parse_raw</strong>(input : <a href="String.html">String</a> | <a href="IO.html">IO</a>) : <a href="JSON/Type.html">Type</a>

        
      </div>
      
        <div class="doc"><p>Parses a JSON document as a <code><a href="JSON/Type.html">JSON::Type</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/bbf7c350dcb11e8906631fb62ac87fb965b23f4d/src/json/json.cr#L61" target="_blank">View source</a>]
        
      </div>
    </div>
  





  <h2>Macro Detail</h2>
  
    <div class="entry-detail" id="mapping(properties,strict=false)-macro">
      <a class="dashingAutolink" name="autolink-2796"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/macro%20mapping%28properties%2C%20strict%20%3D%20false%29"></a><div class="signature">
        
        macro <strong>mapping</strong>(properties, strict = false)

        
      </div>
      
        <div class="doc">
<p>The <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON.mapping</a></code> macro defines how an object is mapped to JSON.</p>

<h3>Example</h3>

<pre><code><span class="k">require</span> <span class="s">&#34;json&#34;</span>

<span class="k">class</span> <span class="t">Location</span>
  <span class="t">JSON</span>.mapping({
    lat: <span class="t">Float64</span>,
    lng: <span class="t">Float64</span>,
  })
<span class="k">end</span>

<span class="k">class</span> <span class="t">House</span>
  <span class="t">JSON</span>.mapping({
    address:  <span class="t">String</span>,
    location: {<span class="k">type</span>: <span class="t">Location</span>, nilable: <span class="n">true</span>},
  })
<span class="k">end</span>

house <span class="o">=</span> <span class="t">House</span>.from_json(<span class="s">%({&#34;address&#34;: &#34;Crystal Road 1234&#34;, &#34;location&#34;: {&#34;lat&#34;: 12.3, &#34;lng&#34;: 34.5}})</span>)
house.address  <span class="c"># =&gt; &#34;Crystal Road 1234&#34;</span>
house.location <span class="c"># =&gt; #&amp;lt;Location:0x10cd93d80 @lat=12.3, @lng=34.5&gt;</span>
house.to_json  <span class="c"># =&gt; %({&#34;address&#34;:&#34;Crystal Road 1234&#34;,&#34;location&#34;:{&#34;lat&#34;:12.3,&#34;lng&#34;:34.5}})</span></code></pre>

<h3>Usage</h3>

<p><code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON.mapping</a></code> must receive a hash literal whose keys will define Crystal properties.</p>

<p>The value of each key can be a single type (not a union type). Primitive types (numbers, string, boolean and nil)
are supported, as well as custom objects which use <code><a href="JSON.html#mapping%28properties%2Cstrict%3Dfalse%29-macro">JSON.mapping</a></code> or define a <code>new</code> method
that accepts a <code><a href="JSON/PullParser.html">JSON::PullParser</a></code> and returns an object from it.</p>

<p>The value can also be another hash literal with the following options:</p>

<ul>
<li>
<strong>type</strong>: (required) the single type described above (you can use <code><a href="JSON/Any.html">JSON::Any</a></code> too)</li>
<li>
<strong>key</strong>: the property name in the JSON document (as opposed to the property name in the Crystal code)</li>
<li>
<strong>nilable</strong>: if true, the property can be <code><a href="Nil.html">Nil</a></code>
</li>
<li>
<strong>default</strong>: value to use if the property is missing in the JSON document, or if it&#39;s <code>null</code> and <code>nilable</code> was not set to <code>true</code>. If the default value creates a new instance of an object (for example <code>[1, 2, 3]</code> or <code>SomeObject.new</code>), a different instance will be used each time a JSON document is parsed.</li>
<li>
<strong>emit_null</strong>: if true, emits a <code>null</code> value for nilable properties (by default nulls are not emitted)</li>
<li>
<strong>converter</strong>: specify an alternate type for parsing and generation. The converter must define <code>from_json(<a href="JSON/PullParser.html">JSON::PullParser</a>)</code> and <code>to_json(value, <a href="IO.html">IO</a>)</code> as class methods. Examples of converters are <code><a href="Time/Format.html">Time::Format</a></code> and <code><a href="Time/EpochConverter.html">Time::EpochConverter</a></code> for <code><a href="Time.html">Time</a></code>.</li>
</ul>

<p>The mapping also automatically defines Crystal properties (getters and setters) for each
of the keys. It doesn&#39;t define a constructor accepting those arguments, but you can provide
an overload.</p>

<p>The macro basically defines a constructor accepting a <code><a href="JSON/PullParser.html">JSON::PullParser</a></code> that reads from
it and initializes this type&#39;s instance variables. It also defines a <code>to_json(<a href="IO.html">IO</a>)</code> method
by invoking <code>to_json(<a href="IO.html">IO</a>)</code> on each of the properties (unless a converter is specified, in
which case <code>to_json(value, <a href="IO.html">IO</a>)</code> is invoked).</p>

<p>This macro also declares instance variables of the types given in the mapping.</p>

<p>If <code>strict</code> is true, unknown properties in the JSON
document will raise a parse exception. The default is <code>false</code>, so unknown properties
are silently ignored.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/bbf7c350dcb11e8906631fb62ac87fb965b23f4d/src/json/mapping.cr#L59" target="_blank">View source</a>]
        
      </div>
    </div>
  


</div>



</body></html>