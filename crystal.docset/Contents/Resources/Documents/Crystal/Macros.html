<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="../css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-1061"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/Crystal%3A%3AMacros%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>Crystal::Macros - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Crystal::Macros

</h1>





  <h2>Overview</h2>

  <p>The Macros module is a fictitious module used to document macros
and macro methods.</p>

<p>You can invoke a <strong>fixed subset</strong> of methods on AST nodes at compile-time. These methods
are documented on the classes in this module. Additionally, methods of the
<code><a href="../Crystal/Macros.html">Macros</a></code> module are top-level methods that you can invoke, like <code><a href="../Crystal/Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code> and <code><a href="../Crystal/Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code>.</p>














  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L7" target="_blank">compiler/crystal/macros.cr</a>
    
    <br/>
  







  <h2>Instance Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#%60%28command%29%3AMacroId-instance-method" class="signature"><strong>#`</strong>(command) : MacroId</a>
        
          <div class="summary"><p>Executes a system command and returns the output as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#compare_versions%28v1%3AStringLiteral%2Cv2%3AStringLiteral%29%3ANumberLiteral-instance-method" class="signature"><strong>#compare_versions</strong>(v1 : StringLiteral, v2 : StringLiteral) : NumberLiteral</a>
        
          <div class="summary"><p>Compares two <a href="http://semver.org/" target="_blank">semantic versions</a>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#debug%28format%3Dtrue%29%3ANop-instance-method" class="signature"><strong>#debug</strong>(format = <span class="n">true</span>) : Nop</a>
        
          <div class="summary"><p>Outputs the current macro&#39;s buffer to the standard output.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#env%28name%29%3AStringLiteral%7CNilLiteral-instance-method" class="signature"><strong>#env</strong>(name) : StringLiteral | NilLiteral</a>
        
          <div class="summary"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn&#39;t exist.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#p%28expression%29%3ANop-instance-method" class="signature"><strong>#p</strong>(expression) : Nop</a>
        
          <div class="summary"><p>Same as <code><a href="../Crystal/Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#puts%28expression%29%3ANop-instance-method" class="signature"><strong>#puts</strong>(expression) : Nop</a>
        
          <div class="summary"><p>Prints an AST node at compile-time.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#raise%28message%29%3ANoReturn-instance-method" class="signature"><strong>#raise</strong>(message) : NoReturn</a>
        
          <div class="summary"><p>Gives a compile-time error with the given message.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#run%28filename%2C%2Aargs%29%3AMacroId-instance-method" class="signature"><strong>#run</strong>(filename, *args) : MacroId</a>
        
          <div class="summary"><p>Compiles and execute a Crystal program and returns its output as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#system%28command%29%3AMacroId-instance-method" class="signature"><strong>#system</strong>(command) : MacroId</a>
        
          <div class="summary"><p>Executes a system command and returns the output as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>




  <h2>Instance Method Detail</h2>
  
    <div class="entry-detail" id="`(command):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-1052"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20%60%28command%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>`</strong>(command) : <a href="../Crystal/Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc"><p>Executes a system command and returns the output as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.
Gives a compile-time error if the command failed to execute.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L40" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="compare_versions(v1:StringLiteral,v2:StringLiteral):NumberLiteral-instance-method">
      <a class="dashingAutolink" name="autolink-1053"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20compare_versions%28v1%20%3A%20StringLiteral%2C%20v2%20%3A%20StringLiteral%29%20%3A%20NumberLiteral"></a><div class="signature">
        
        def <strong>compare_versions</strong>(v1 : <a href="../Crystal/Macros/StringLiteral.html">StringLiteral</a>, v2 : <a href="../Crystal/Macros/StringLiteral.html">StringLiteral</a>) : <a href="../Crystal/Macros/NumberLiteral.html">NumberLiteral</a>

        
      </div>
      
        <div class="doc">
<p>Compares two <a href="http://semver.org/" target="_blank">semantic versions</a>.
Returns <code>-1</code> if <code>v1 &lt; v2</code>, <code>0</code> if <code>v1 == v2</code> and <code>1</code> if <code>v1 &gt; v2</code>.</p>

<pre><code>{{ compare_versions(<span class="s">&#34;1.10.0&#34;</span>, <span class="s">&#34;1.2.0&#34;</span>) }} <span class="c"># =&gt; 1</span></code></pre>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L14" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="debug(format=true):Nop-instance-method">
      <a class="dashingAutolink" name="autolink-1054"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20debug%28format%20%3D%20true%29%20%3A%20Nop"></a><div class="signature">
        
        def <strong>debug</strong>(format = <span class="n">true</span>) : <a href="../Crystal/Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc">
<p>Outputs the current macro&#39;s buffer to the standard output. Useful for debugging
a macro to see what&#39;s being generated. Use it like <code>{{debug()}}</code>, the parenthesis
are mandatory.</p>

<p>By default, the output is tried to be formatted using Crystal&#39;s
formatter, but you can disable this by passing <code>false</code> to this method.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L23" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="env(name):StringLiteral|NilLiteral-instance-method">
      <a class="dashingAutolink" name="autolink-1055"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20env%28name%29%20%3A%20StringLiteral%20%7C%20NilLiteral"></a><div class="signature">
        
        def <strong>env</strong>(name) : <a href="../Crystal/Macros/StringLiteral.html">StringLiteral</a> | <a href="../Crystal/Macros/NilLiteral.html">NilLiteral</a>

        
      </div>
      
        <div class="doc"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn&#39;t exist.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L27" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="p(expression):Nop-instance-method">
      <a class="dashingAutolink" name="autolink-1056"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20p%28expression%29%20%3A%20Nop"></a><div class="signature">
        
        def <strong>p</strong>(expression) : <a href="../Crystal/Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc"><p>Same as <code><a href="../Crystal/Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L35" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="puts(expression):Nop-instance-method">
      <a class="dashingAutolink" name="autolink-1057"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20puts%28expression%29%20%3A%20Nop"></a><div class="signature">
        
        def <strong>puts</strong>(expression) : <a href="../Crystal/Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc"><p>Prints an AST node at compile-time. Useful for debugging macros.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L31" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="raise(message):NoReturn-instance-method">
      <a class="dashingAutolink" name="autolink-1058"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20raise%28message%29%20%3A%20NoReturn"></a><div class="signature">
        
        def <strong>raise</strong>(message) : NoReturn

        
      </div>
      
        <div class="doc"><p>Gives a compile-time error with the given message.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L48" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="run(filename,*args):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-1059"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20run%28filename%2C%20%2Aargs%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>run</strong>(filename, *args) : <a href="../Crystal/Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc">
<p>Compiles and execute a Crystal program and returns its output
as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.</p>

<p>The file denote by <em>filename</em> must be a valid Crystal program.
This macro invocation passes <em>args</em> to the program as regular
program arguments. The program must output a valid Crystal expression.
This output is the result of this macro invocation, as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.</p>

<p>The <code><a href="../Crystal/Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> macro is useful when the subset of available macro methods
are not enough for your purposes and you need something more powerful.
With <code><a href="../Crystal/Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> you can read files at compile time, connect to the internet
or to a database.</p>

<p>A simple example:</p>

<pre><code><span class="c"># read.cr</span>
puts <span class="t">File</span>.read(<span class="t">ARGV</span>[<span class="n">0</span>])</code></pre>

<pre><code><span class="c"># main.cr</span>
<span class="k">macro</span> read_file_at_compile_time(filename)
  {{ run(<span class="s">&#34;./read&#34;</span>, filename).stringify }}
<span class="k">end</span>

puts read_file_at_compile_time(<span class="s">&#34;some_file.txt&#34;</span>)</code></pre>

<p>The above generates a program that will have the contents of <code>some_file.txt</code>.
The file, however, is read at compile time and will not be needed at runtime.</p>

<p><span class="flag purple">NOTE</span>  the compiler is allowed to cache the executable generated for
<em>filename</em> and only recompile it if any of the files it depends on changes
(their modified time). This is why it&#39;s <strong>strongly discouraged</strong> to use a program
for <code><a href="../Crystal/Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> that changes in subsequent compilations (for example, if it executes
shell commands at compile time, or other macro run programs). It&#39;s also strongly
discouraged to have a macro run program take a lot of time, because this will
slow down compilation times. Reading files is OK, opening an HTTP connection
at compile-time will most likely result if very slow compilations.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L91" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="system(command):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-1060"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20system%28command%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>system</strong>(command) : <a href="../Crystal/Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc"><p>Executes a system command and returns the output as a <code><a href="../Crystal/Macros/MacroId.html">MacroId</a></code>.
Gives a compile-time error if the command failed to execute.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/3c6c75e68f326bb91be35f71ae30672fd454776e/src/compiler/crystal/macros.cr#L44" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>



</body></html>