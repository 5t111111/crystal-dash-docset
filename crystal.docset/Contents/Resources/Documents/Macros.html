<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-3248"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/Macros%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>Macros - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Macros

</h1>





  <h2>Overview</h2>

  <p>The Macros module is a fictitious module used to document macros
and macro methods.</p>

<p>You can invoke a <strong>fixed subset</strong> of methods on AST nodes at compile-time. These methods
are documented on the classes in this module. Additionally, methods of the
<code><a href="Macros.html">Macros</a></code> module are top-level methods that you can invoke, like <code><a href="Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code> and <code><a href="Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code>.</p>














  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr" target="_blank">docs/macros.cr</a>
    
    <br/>
  







  <h2>Instance Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#%60%28command%29%3AMacroId-instance-method" class="signature"><strong>#`</strong>(command) : MacroId</a>
        
          <div class="summary"><p>Executes a system command and returns the output as a <code><a href="Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#debug%3ANop-instance-method" class="signature"><strong>#debug</strong> : Nop</a>
        
          <div class="summary"><p>Outputs the current macro&#39;s buffer to the standard output.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#env%28name%29%3AStringLiteral%7CNilLiteral-instance-method" class="signature"><strong>#env</strong>(name) : StringLiteral | NilLiteral</a>
        
          <div class="summary"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn&#39;t exist.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#p%28expression%29%3ANop-instance-method" class="signature"><strong>#p</strong>(expression) : Nop</a>
        
          <div class="summary"><p>Same as <code><a href="Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#puts%28expression%29%3ANop-instance-method" class="signature"><strong>#puts</strong>(expression) : Nop</a>
        
          <div class="summary"><p>Prints an AST node at compile-time.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#raise%28message%29%3ANoReturn-instance-method" class="signature"><strong>#raise</strong>(message) : NoReturn</a>
        
          <div class="summary"><p>Gives a compile-time error with the given message.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#run%28filename%2C%2Aargs%29%3AMacroId-instance-method" class="signature"><strong>#run</strong>(filename, *args) : MacroId</a>
        
          <div class="summary"><p>Compiles and execute a Crystal program and returns its output as a <code><a href="Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#system%28command%29%3AMacroId-instance-method" class="signature"><strong>#system</strong>(command) : MacroId</a>
        
          <div class="summary"><p>Executes a system command and returns the output as a <code><a href="Macros/MacroId.html">MacroId</a></code>.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>




  <h2>Instance Method Detail</h2>
  
    <div class="entry-detail" id="`(command):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-3240"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20%60%28command%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>`</strong>(command) : <a href="Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc"><p>Executes a system command and returns the output as a <code><a href="Macros/MacroId.html">MacroId</a></code>.
Gives a compile-time error if the command failed to execute.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L28" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="debug:Nop-instance-method">
      <a class="dashingAutolink" name="autolink-3241"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20debug%20%3A%20Nop"></a><div class="signature">
        
        def <strong>debug</strong> : <a href="Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc"><p>Outputs the current macro&#39;s buffer to the standard output. Useful for debugging
a macro to see what&#39;s being generated. Use it like <code>{{debug()}}</code>, the parenthesis
are mandatory.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L11" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="env(name):StringLiteral|NilLiteral-instance-method">
      <a class="dashingAutolink" name="autolink-3242"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20env%28name%29%20%3A%20StringLiteral%20%7C%20NilLiteral"></a><div class="signature">
        
        def <strong>env</strong>(name) : <a href="Macros/StringLiteral.html">StringLiteral</a> | <a href="Macros/NilLiteral.html">NilLiteral</a>

        
      </div>
      
        <div class="doc"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn&#39;t exist.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L15" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="p(expression):Nop-instance-method">
      <a class="dashingAutolink" name="autolink-3243"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20p%28expression%29%20%3A%20Nop"></a><div class="signature">
        
        def <strong>p</strong>(expression) : <a href="Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc"><p>Same as <code><a href="Macros.html#puts%28expression%29%3ANop-instance-method">#puts</a></code>.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L23" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="puts(expression):Nop-instance-method">
      <a class="dashingAutolink" name="autolink-3244"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20puts%28expression%29%20%3A%20Nop"></a><div class="signature">
        
        def <strong>puts</strong>(expression) : <a href="Macros/Nop.html">Nop</a>

        
      </div>
      
        <div class="doc"><p>Prints an AST node at compile-time. Useful for debugging macros.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L19" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="raise(message):NoReturn-instance-method">
      <a class="dashingAutolink" name="autolink-3245"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20raise%28message%29%20%3A%20NoReturn"></a><div class="signature">
        
        def <strong>raise</strong>(message) : NoReturn

        
      </div>
      
        <div class="doc"><p>Gives a compile-time error with the given message.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L36" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="run(filename,*args):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-3246"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20run%28filename%2C%20%2Aargs%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>run</strong>(filename, *args) : <a href="Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc">
<p>Compiles and execute a Crystal program and returns its output
as a <code><a href="Macros/MacroId.html">MacroId</a></code>.</p>

<p>The file denote by <em>filename</em> must be a valid Crystal program.
This macro invocation passes <em>args</em> to the program as regular
program arguments. The program must output a valid Crystal expression.
This output is the result of this macro invocation, as a <code><a href="Macros/MacroId.html">MacroId</a></code>.</p>

<p>The <code><a href="Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> macro is useful when the subset of available macro methods
are not enough for your purposes and you need something more powerful.
With <code><a href="Macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> you can read files at compile time, connect to the internet
or to a database.</p>

<p>A simple example:</p>

<pre><code><span class="c"># fetch.cr</span>
<span class="k">require</span> <span class="s">&#34;http/client&#34;</span>

puts <span class="t">HTTP</span><span class="t">::</span><span class="t">Client</span>.get(<span class="t">ARGV</span>[<span class="n">0</span>]).body</code></pre>

<pre><code><span class="c"># main.cr</span>
<span class="k">macro</span> invoke_fetch
  {{ run(<span class="s">&#34;./fetch&#34;</span>, <span class="s">&#34;http://example.com&#34;</span>).stringify }}
<span class="k">end</span>

puts invoke_fetch</code></pre>

<p>The above generates a program that will have the contents of <code>http://example.com</code>.
A connection to <code>http://example.com</code> is never made at runtime.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L72" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="system(command):MacroId-instance-method">
      <a class="dashingAutolink" name="autolink-3247"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20system%28command%29%20%3A%20MacroId"></a><div class="signature">
        
        def <strong>system</strong>(command) : <a href="Macros/MacroId.html">MacroId</a>

        
      </div>
      
        <div class="doc"><p>Executes a system command and returns the output as a <code><a href="Macros/MacroId.html">MacroId</a></code>.
Gives a compile-time error if the command failed to execute.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/8272664e3d0c1e9fbf657a7626a874ffa19a4938/docs/macros.cr#L32" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>



</body></html>