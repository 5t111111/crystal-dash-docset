<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-1133"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/Crystal%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>Crystal - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Crystal

</h1>


















  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/crystal/main.cr#L14" target="_blank">crystal/main.cr</a>
    
    <br/>
  



  
    <h2>Constant Summary</h2>
  
  <dl>
    
      <dt class="entry-const" id="BUILD_COMMIT">
        <strong>BUILD_COMMIT</strong> = <code><span class="s">&#34;4f9ed8d03&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="BUILD_DATE">
        <strong>BUILD_DATE</strong> = <code><span class="s">&#34;2018-03-08&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="CACHE_DIR">
        <strong>CACHE_DIR</strong> = <code><span class="s">&#34;/root/.cache/crystal&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="DEFAULT_PATH">
        <strong>DEFAULT_PATH</strong> = <code><span class="s">&#34;&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="DESCRIPTION">
        <strong>DESCRIPTION</strong> = <code><span class="s">&#34;Crystal 0.24.2 [4f9ed8d03] (2018-03-08)\n\nLLVM: 4.0.0\nDefault target: x86_64-unknown-linux-gnu&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="LLVM_VERSION">
        <strong>LLVM_VERSION</strong> = <code><span class="s">&#34;4.0.0&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="PATH">
        <strong>PATH</strong> = <code><span class="s">&#34;/crystal/src:lib&#34;</span></code>
      </dt>
      
    
      <dt class="entry-const" id="VERSION">
        <strong>VERSION</strong> = <code><span class="s">&#34;0.24.2&#34;</span></code>
      </dt>
      
    
  </dl>





  <h2>Class Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#main%28%26block%29-class-method" class="signature"><strong>.main</strong>(&amp;block)</a>
        
          <div class="summary"><p>Defines the main routine run by normal Crystal programs:</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#main%28argc%3AInt32%2Cargv%3APointer%28Pointer%28UInt8%29%29%29-class-method" class="signature"><strong>.main</strong>(argc : Int32, argv : Pointer(Pointer(UInt8)))</a>
        
          <div class="summary"><p>Main method run by all Crystal programs at startup.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#main_user_code%28argc%3AInt32%2Cargv%3APointer%28Pointer%28UInt8%29%29%29-class-method" class="signature"><strong>.main_user_code</strong>(argc : Int32, argv : Pointer(Pointer(UInt8)))</a>
        
          <div class="summary"><p>Executes the main user code.</p></div>
        
      </li>
    
  </ul>







<div class="methods-inherited">
  
</div>




  <h2>Class Method Detail</h2>
  
    <div class="entry-detail" id="main(&amp;block)-class-method">
      <a class="dashingAutolink" name="autolink-1134"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.main%28%26block%29"></a><div class="signature">
        
        def self.<strong>main</strong>(&amp;block)

        
      </div>
      
        <div class="doc">
<p>Defines the main routine run by normal Crystal programs:</p>

<ul>
<li>Initializes the GC</li>
<li>Invokes the given <em>block</em>
</li>
<li>Handles unhandled exceptions</li>
<li>Invokes <code>at_exit</code> handlers</li>
<li>Flushes <code><a href="toplevel.html#STDOUT">STDOUT</a></code> and <code><a href="toplevel.html#STDERR">STDERR</a></code>
</li>
</ul>

<p>This method can be invoked if you need to define a custom
main (as in C main) function, doing all the above steps.</p>

<p>For example:</p>

<pre><code><span class="k">fun</span> main(argc : <span class="t">Int32</span>, argv : <span class="t">UInt8</span><span class="o">**</span>) : <span class="t">Int32</span>
  <span class="t">Crystal</span>.main <span class="k">do</span>
    elapsed <span class="o">=</span> <span class="t">Time</span>.measure <span class="k">do</span>
      <span class="t">Crystal</span>.main_user_code(argc, argv)
    <span class="k">end</span>
    puts <span class="s">&#34;Time to execute program: </span><span class="i">#{</span>elapsed<span class="s"><span class="i">}</span>&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Note that the above is really just an example, almost the
same can be accomplished with <code>at_exit</code>. But in some cases
redefinition of C&#39;s main is needed.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/crystal/main.cr#L46" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="main(argc:Int32,argv:Pointer(Pointer(UInt8)))-class-method">
      <a class="dashingAutolink" name="autolink-1135"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.main%28argc%20%3A%20Int32%2C%20argv%20%3A%20Pointer%28Pointer%28UInt8%29%29%29"></a><div class="signature">
        
        def self.<strong>main</strong>(argc : <a href="Int32.html">Int32</a>, argv : <a href="Pointer.html">Pointer</a>(<a href="Pointer.html">Pointer</a>(<a href="UInt8.html">UInt8</a>)))

        
      </div>
      
        <div class="doc">
<p>Main method run by all Crystal programs at startup.</p>

<p>This setups up the GC, invokes your program, rescuing
any handled exception, and then runs <code>at_exit</code> handlers.</p>

<p>This method is automatically invoked for you, so you
don&#39;t need to invoke it.</p>

<p>However, if you need to define a special main C function,
you can redefine main and invoke <code><a href="Crystal.html#main%28%26block%29-class-method">Crystal.main</a></code> from it:</p>

<pre><code><span class="k">fun</span> main(argc : <span class="t">Int32</span>, argv : <span class="t">UInt8</span><span class="o">**</span>) : <span class="t">Int32</span>
  <span class="c"># some setup before Crystal main</span>
  <span class="t">Crystal</span>.main(argc, argv)
  <span class="c"># some cleanup logic after Crystal main</span>
<span class="k">end</span></code></pre>

<p>The <code><a href="Crystal.html#main%28%26block%29-class-method">Crystal.main</a></code> can also be passed as a callback:</p>

<pre><code><span class="k">fun</span> main(argc : <span class="t">Int32</span>, argv : <span class="t">UInt8</span><span class="o">**</span>) : <span class="t">Int32</span>
  <span class="t">LibFoo</span>.init_foo_and_invoke_main(argc, argv, -&gt;<span class="t">Crystal</span>.main)
<span class="k">end</span></code></pre>

<p>Note that before <code><a href="Crystal.html#main%28%26block%29-class-method">Crystal.main</a></code> is invoked the GC
is not setup yet, so nothing that allocates memory
in Crystal (like <code>new</code> for classes) can be used.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/crystal/main.cr#L99" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="main_user_code(argc:Int32,argv:Pointer(Pointer(UInt8)))-class-method">
      <a class="dashingAutolink" name="autolink-1136"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20self.main_user_code%28argc%20%3A%20Int32%2C%20argv%20%3A%20Pointer%28Pointer%28UInt8%29%29%29"></a><div class="signature">
        
        def self.<strong>main_user_code</strong>(argc : <a href="Int32.html">Int32</a>, argv : <a href="Pointer.html">Pointer</a>(<a href="Pointer.html">Pointer</a>(<a href="UInt8.html">UInt8</a>)))

        
      </div>
      
        <div class="doc">
<p>Executes the main user code. This normally is executed
after initializing the GC and before executing <code>at_exit</code> handlers.</p>

<p>You should never invoke this method unless you need to
redefine C&#39;s main function. See <code><a href="Crystal.html#main%28%26block%29-class-method">Crystal.main</a></code> for
more details.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/crystal/main.cr#L111" target="_blank">View source</a>]
        
      </div>
    </div>
  






</div>



</body></html>