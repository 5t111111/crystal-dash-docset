<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-207"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/Benchmark%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>Benchmark - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Benchmark

</h1>





  <h2>Overview</h2>

  <p>The Benchmark module provides methods for benchmarking Crystal code, giving
detailed reports on the time taken for each task.</p>

<h3>Measure the number of iterations per second of each task</h3>

<pre><code><span class="k">require</span> <span class="s">&#34;benchmark&#34;</span>
<span class="t">Benchmark</span>.ips <span class="k">do</span> <span class="o">|</span>x<span class="o">|</span>
  x.report(<span class="s">&#34;short sleep&#34;</span>) { sleep <span class="n">0.01</span> }
  x.report(<span class="s">&#34;shorter sleep&#34;</span>) { sleep <span class="n">0.001</span> }
<span class="k">end</span></code></pre>

<p>This generates the following output showing the mean iterations per second,
the standard deviation relative to the mean, and a comparison:</p>

<pre><code class="language-text">  short sleep    91.82 (&plusmn; 2.51%)  8.72&times; slower
shorter sleep   800.98 (&plusmn; 1.10%)       fastest</code></pre>

<p><code><a href="Benchmark/IPS.html">Benchmark::IPS</a></code> defaults to 2 seconds of warmup time and 5 seconds of
calculation time. This can be configured:</p>

<pre><code><span class="t">Benchmark</span>.ips(warmup: <span class="n">4</span>, calculation: <span class="n">10</span>) <span class="k">do</span> <span class="o">|</span>x<span class="o">|</span>
  <span class="c"># &hellip;</span>
<span class="k">end</span></code></pre>

<p>Make sure to always benchmark code by compiling with the <code>--release</code> flag.</p>

<h3>Measure the time to construct the string given by the expression: <code>&#34;a&#34;*1_000_000_000</code>
</h3>

<pre><code><span class="k">require</span> <span class="s">&#34;benchmark&#34;</span>

puts <span class="t">Benchmark</span>.measure { <span class="s">&#34;a&#34;</span><span class="o">*</span><span class="n">1_000_000_000</span> }</code></pre>

<p>This generates the following output:</p>

<pre><code class="language-text"> 0.190000   0.220000   0.410000 (  0.420185)</code></pre>

<p>This report shows the user CPU time, system CPU time, the sum of
the user and system CPU times, and the elapsed real time. The unit
of time is seconds.</p>

<h3>Do some experiments sequentially using the <code><a href="Benchmark.html#bm%28%26block%29-instance-method">#bm</a></code> method:</h3>

<pre><code><span class="k">require</span> <span class="s">&#34;benchmark&#34;</span>

n <span class="o">=</span> <span class="n">5000000</span>
<span class="t">Benchmark</span>.bm <span class="k">do</span> <span class="o">|</span>x<span class="o">|</span>
  x.report(<span class="s">&#34;times:&#34;</span>) { n.times <span class="k">do</span>
    a <span class="o">=</span> <span class="s">&#34;1&#34;</span>
  <span class="k">end</span> }
  x.report(<span class="s">&#34;upto:&#34;</span>) { <span class="n">1</span>.upto(n) <span class="k">do</span>
    a <span class="o">=</span> <span class="s">&#34;1&#34;</span>
  <span class="k">end</span> }
<span class="k">end</span></code></pre>

<p>The result:</p>

<pre><code class="language-text">           user     system      total        real
times:   0.010000   0.000000   0.010000 (  0.008976)
upto:    0.010000   0.000000   0.010000 (  0.010466)</code></pre>

<p>Make sure to always benchmark code by compiling with the <code>--release</code> flag.</p>







  <h2>Extended Modules</h2>
  <ul class="other-types-list">
  
    <li class="other-type"><a href="Benchmark.html">Benchmark</a></li>
  
  </ul>








  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark/bm.cr#L1" target="_blank">benchmark/bm.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark/ips.cr#L1" target="_blank">benchmark/ips.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark.cr#L78" target="_blank">benchmark.cr</a>
    
    <br/>
  







  <h2>Instance Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#bm%28%26block%29-instance-method" class="signature"><strong>#bm</strong>(&amp;block)</a>
        
          <div class="summary"><p>Main interface of the <code><a href="Benchmark.html">Benchmark</a></code> module.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#ips%28calculation%3D%3Cspanclass%3D%22n%22%3E5%3C%2Fspan%3E%2Cwarmup%3D%3Cspanclass%3D%22n%22%3E2%3C%2Fspan%3E%2Cinteractive%3D%3Cspanclass%3D%22t%22%3ESTDOUT%3C%2Fspan%3E.tty%3F%2C%26block%29-instance-method" class="signature"><strong>#ips</strong>(calculation = <span class="n">5</span>, warmup = <span class="n">2</span>, interactive = <span class="t">STDOUT</span>.tty?, &amp;block)</a>
        
          <div class="summary"><p>Instruction per second interface of the <code><a href="Benchmark.html">Benchmark</a></code> module.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#measure%28label%3D%3Cspanclass%3D%22s%22%3E%26quot%3B%26quot%3B%3C%2Fspan%3E%2C%26block%29%3ABM%3A%3ATms-instance-method" class="signature"><strong>#measure</strong>(label = <span class="s">&#34;&#34;</span>, &amp;block) : BM::Tms</a>
        
          <div class="summary"><p>Returns the time used to execute the given block.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#realtime%28%26block%29%3ATime%3A%3ASpan-instance-method" class="signature"><strong>#realtime</strong>(&amp;block) : Time::Span</a>
        
          <div class="summary"><p>Returns the elapsed real time used to execute the given block.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>




  <h2>Instance Method Detail</h2>
  
    <div class="entry-detail" id="bm(&amp;block)-instance-method">
      <a class="dashingAutolink" name="autolink-203"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20bm%28%26block%29"></a><div class="signature">
        
        def <strong>bm</strong>(&amp;block)

        
      </div>
      
        <div class="doc"><p>Main interface of the <code><a href="Benchmark.html">Benchmark</a></code> module. Yields a <code>Job</code> to which
one can report the benchmarks. See the module&#39;s description.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark.cr#L83" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="ips(calculation=&lt;spanclass=&#34;n&#34;&gt;5&lt;/span&gt;,warmup=&lt;spanclass=&#34;n&#34;&gt;2&lt;/span&gt;,interactive=&lt;spanclass=&#34;t&#34;&gt;STDOUT&lt;/span&gt;.tty?,&amp;block)-instance-method">
      <a class="dashingAutolink" name="autolink-204"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20ips%28calculation%20%3D%205%2C%20warmup%20%3D%202%2C%20interactive%20%3D%20STDOUT.tty%3F%2C%20%26block%29"></a><div class="signature">
        
        def <strong>ips</strong>(calculation = <span class="n">5</span>, warmup = <span class="n">2</span>, interactive = <span class="t">STDOUT</span>.tty?, &amp;block)

        
      </div>
      
        <div class="doc">
<p>Instruction per second interface of the <code><a href="Benchmark.html">Benchmark</a></code> module. Yields a <code>Job</code>
to which one can report the benchmarks. See the module&#39;s description.</p>

<p>The optional parameters <code>calculation</code> and <code>warmup</code> set the duration of
those stages in seconds. For more detail on these stages see
<code><a href="Benchmark/IPS.html">Benchmark::IPS</a></code>. When the <code>interactive</code> parameter is true, results are
displayed and updated as they are calculated, otherwise all at once.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark.cr#L101" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="measure(label=&lt;spanclass=&#34;s&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,&amp;block):BM::Tms-instance-method">
      <a class="dashingAutolink" name="autolink-205"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20measure%28label%20%3D%20%22%22%2C%20%26block%29%20%3A%20BM%3A%3ATms"></a><div class="signature">
        
        def <strong>measure</strong>(label = <span class="s">&#34;&#34;</span>, &amp;block) : <a href="Benchmark/BM/Tms.html">BM::Tms</a>

        
      </div>
      
        <div class="doc"><p>Returns the time used to execute the given block.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark.cr#L114" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="realtime(&amp;block):Time::Span-instance-method">
      <a class="dashingAutolink" name="autolink-206"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20realtime%28%26block%29%20%3A%20Time%3A%3ASpan"></a><div class="signature">
        
        def <strong>realtime</strong>(&amp;block) : <a href="Time/Span.html">Time::Span</a>

        
      </div>
      
        <div class="doc">
<p>Returns the elapsed real time used to execute the given block.</p>

<pre><code><span class="t">Benchmark</span>.realtime { <span class="s">&#34;a&#34;</span> <span class="o">*</span> <span class="n">100_000</span> } <span class="c"># =&gt; 00:00:00.0005840</span></code></pre>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/68783f1ebdd5b9bbefc8892ddbc200fe1f13bbea/src/benchmark.cr#L131" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>



</body></html>