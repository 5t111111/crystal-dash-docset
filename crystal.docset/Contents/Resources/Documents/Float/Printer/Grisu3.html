<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="../../css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-2046"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/Float%3A%3APrinter%3A%3AGrisu3%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>Float::Printer::Grisu3 - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Float::Printer::Grisu3

</h1>











  <h2>Extended Modules</h2>
  <ul class="other-types-list">
  
    <li class="other-type"><a href="../../Float/Printer/Grisu3.html">Float::Printer::Grisu3</a></li>
  
  </ul>








  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/float/printer/grisu3.cr#L34" target="_blank">float/printer/grisu3.cr</a>
    
    <br/>
  









  <h2>Instance Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#digit_gen%28low%3ADiyFP%2Cw%3ADiyFP%2Chigh%3ADiyFP%2Cbuffer_p%29%3ATuple%28Bool%2CInt32%2CInt32%29-instance-method" class="signature"><strong>#digit_gen</strong>(low : DiyFP, w : DiyFP, high : DiyFP, buffer_p) : Tuple(Bool, Int32, Int32)</a>
        
          <div class="summary"><p>Generates the digits of input number w.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#grisu3%28v%3AFloat64%7CFloat32%2Cbuffer_p%29%3ATuple%28Bool%2CInt32%2CInt32%29-instance-method" class="signature"><strong>#grisu3</strong>(v : Float64 | Float32, buffer_p) : Tuple(Bool, Int32, Int32)</a>
        
          <div class="summary"><p>Provides a decimal representation of <em>v</em>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#round_weed%28buffer_p%2Clength%2Cdistance_too_high_w%2Cunsafe_interval%2Crest%2Cten_kappa%2Cunit%29-instance-method" class="signature"><strong>#round_weed</strong>(buffer_p, length, distance_too_high_w, unsafe_interval, rest, ten_kappa, unit)</a>
        
          <div class="summary"><p>Adjusts the last digit of the generated number, and screens out generated solutions that may be inaccurate.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>






  <h2>Instance Method Detail</h2>
  
    <div class="entry-detail" id="digit_gen(low:DiyFP,w:DiyFP,high:DiyFP,buffer_p):Tuple(Bool,Int32,Int32)-instance-method">
      <a class="dashingAutolink" name="autolink-2047"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20digit_gen%28low%20%3A%20DiyFP%2C%20w%20%3A%20DiyFP%2C%20high%20%3A%20DiyFP%2C%20buffer_p%29%20%3A%20Tuple%28Bool%2C%20Int32%2C%20Int32%29"></a><div class="signature">
        
        def <strong>digit_gen</strong>(low : <a href="../../Float/Printer/DiyFP.html">DiyFP</a>, w : <a href="../../Float/Printer/DiyFP.html">DiyFP</a>, high : <a href="../../Float/Printer/DiyFP.html">DiyFP</a>, buffer_p) : <a href="../../Tuple.html">Tuple</a>(<a href="../../Bool.html">Bool</a>, <a href="../../Int32.html">Int32</a>, <a href="../../Int32.html">Int32</a>)

        
      </div>
      
        <div class="doc">
<p>Generates the digits of input number w.
w is a floating-point number (DiyFp), consisting of a significand and an
exponent. Its exponent is bounded by kMinimalTargetExponent and
kMaximalTargetExponent.</p>

<pre><code>  <span class="t">Hence</span> <span class="n">-60</span> <span class="o">&lt;=</span> w.e() <span class="o">&lt;=</span> <span class="n">-32</span>.</code></pre>

<p>Returns false if it fails, in which case the generated digits in the buffer
should not be used.
Preconditions:</p>

<ul>
<li>low, w and high are correct up to 1 ulp (unit in the last place). That
   is, their error must be less than a unit of their last digits.</li>
<li>low.e() == w.e() == high.e()</li>
<li>low &lt; w &lt; high, and taking into account their error: low~ &lt;= high~</li>
<li>kMinimalTargetExponent &lt;= w.e() &lt;= kMaximalTargetExponent
Postconditions: returns false if procedure fails.
  otherwise:</li>
<ul>
<li>buffer is not null-terminated, but len contains the number of digits.</li>
<li>buffer contains the shortest possible decimal digit-sequence</li>
</ul>

</ul>
<pre><code>  such that <span class="t">LOW</span> <span class="o">&lt;</span> buffer <span class="o">*</span> <span class="n">10</span><span class="o">^</span>kappa <span class="o">&lt;</span> <span class="t">HIGH</span>, where <span class="t">LOW</span> and <span class="t">HIGH</span> are the
  correct values <span class="k">of</span> low and high (without their error).
<span class="o">*</span> <span class="k">if</span> more than one decimal representation gives the minimal number <span class="k">of</span>
  decimal digits <span class="k">then</span> the one closest to <span class="t">W</span> (where <span class="t">W</span> is the correct value
  <span class="k">of</span> w) is chosen.</code></pre>

<p>Remark: this procedure takes into account the imprecision of its input
  numbers. If the precision is not enough to guarantee all the postconditions
  then false is returned. This usually happens rarely (~0.5%).</p>

<p>Say, for the sake of example, that
  w.e() == -48, and w.f() == 0x1234567890abcdef
w&#39;s value can be computed by w.f() * 2^w.e()
We can obtain w&#39;s integral digits by simply shifting w.f() by -w.e().
 -&gt; w&#39;s integral part is 0x1234
 w&#39;s fractional part is therefore 0x567890abcdef.
Printing w&#39;s integral part is easy (simply print 0x1234 in decimal).
In order to print its fraction we repeatedly multiply the fraction by 10 and
get each digit. Example the first digit after the point would be computed by
  (0x567890abcdef * 10) &gt;&gt; 48. -&gt; 3
The whole thing becomes slightly more complicated because we want to stop
once we have enough digits. That is, once the digits inside the buffer
represent &#39;w&#39; we can stop. Everything inside the interval low - high
represents w. However we have to pay attention to low, high and w&#39;s
imprecision.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/float/printer/grisu3.cr#L200" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="grisu3(v:Float64|Float32,buffer_p):Tuple(Bool,Int32,Int32)-instance-method">
      <a class="dashingAutolink" name="autolink-2048"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20grisu3%28v%20%3A%20Float64%20%7C%20Float32%2C%20buffer_p%29%20%3A%20Tuple%28Bool%2C%20Int32%2C%20Int32%29"></a><div class="signature">
        
        def <strong>grisu3</strong>(v : <a href="../../Float64.html">Float64</a> | <a href="../../Float32.html">Float32</a>, buffer_p) : <a href="../../Tuple.html">Tuple</a>(<a href="../../Bool.html">Bool</a>, <a href="../../Int32.html">Int32</a>, <a href="../../Int32.html">Int32</a>)

        
      </div>
      
        <div class="doc">
<p>Provides a decimal representation of <em>v</em>.</p>

<p>Returns a <code><a href="../../Tuple.html">Tuple</a></code> of <code>{status, decimal_exponent, length}</code>
<em>status</em> will be true if it succeeds, otherwise the result cannot be
trusted.
There will be <em>length</em> digits inside the buffer (not null-terminated).
If the function returns satatus as true true then</p>

<pre><code>   v <span class="o">==</span> (buffer <span class="o">*</span> <span class="n">10</span><span class="o">^</span>decimal_exponent).to_f</code></pre>

<p>The digits in the buffer are the shortest representation possible: no</p>

<ol><li>09999999999999999 instead of 0.1. The shorter representation will even be
chosen even if the longer one would be closer to <em>v</em>.
The last digit will be closest to the actual <em>v</em>. That is, even if several
digits might correctly yield <em>v</em> when read again, the closest will be
computed.</li></ol>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/float/printer/grisu3.cr#L310" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="round_weed(buffer_p,length,distance_too_high_w,unsafe_interval,rest,ten_kappa,unit)-instance-method">
      <a class="dashingAutolink" name="autolink-2049"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/def%20round_weed%28buffer_p%2C%20length%2C%20distance_too_high_w%2C%20unsafe_interval%2C%20rest%2C%20ten_kappa%2C%20unit%29"></a><div class="signature">
        
        def <strong>round_weed</strong>(buffer_p, length, distance_too_high_w, unsafe_interval, rest, ten_kappa, unit)

        
      </div>
      
        <div class="doc">
<p>Adjusts the last digit of the generated number, and screens out generated
solutions that may be inaccurate. A solution may be inaccurate if it is
outside the safe interval, or if we cannot prove that it is closer to the
input than a neighboring representation of the same length.</p>

<p>Input: * buffer pointer containing the digits of too_high / 10^kappa</p>

<pre><code>   <span class="o">*</span> the buffer</code></pre>

<p>Output: returns true if the buffer is guaranteed to contain the closest
   representable number to the input.
 Modifies the generated digits in the buffer to approach (round towards) w.</p>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/float/printer/grisu3.cr#L52" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>



</body></html>