<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta id="repository-name" content="github.com/crystal-lang/crystal"/>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  
  <a class="dashingAutolink" name="autolink-1428"></a><a class="dashAnchor" name="//apple_ref/cpp/Class/ECR%20-%20github.com%2Fcrystal-lang%2Fcrystal"></a><title>ECR - github.com/crystal-lang/crystal</title>
</head>
<body>



<div id="main-content">
<h1 class="type-name">

  <span class="kind">module</span> ECR

</h1>





  <h2>Overview</h2>

  <p>Embedded Crystal (ECR) is a template language for embedding Crystal code into other text,
that includes but is not limited to HTML. The template is read and transformed
at compile time and then embedded into the binary.</p>

<p>There are <code></code> and <code></code> syntax. The former will render returned values.
The latter will not, but instead serve to control the structure as we do in Crystal.</p>

<p>Using a dash inside <code>&lt;...&gt;<!--...--></code> either eliminates previous indentation or removes the next newline:</p>

<ul>
<li>
<code></code>: removes previous indentation</li>
<li>
<code></code>: removes next newline</li>
<li>
<code></code>: removes previous indentation</li>
<li>
<code></code>: removes next newline</li>
</ul>

<p>Quick Example:</p>

<pre><code><span class="k">require</span> <span class="s">&#34;ecr&#34;</span>

<span class="k">class</span> <span class="t">Greeting</span>
  <span class="k">def</span> <span class="m">initialize</span>(@name : <span class="t">String</span>)
  <span class="k">end</span>

  <span class="t">ECR</span>.def_to_s <span class="s">&#34;greeting.ecr&#34;</span>
<span class="k">end</span>

<span class="c"># greeting.ecr</span>
<span class="t">Greeting</span>, <span class="o">&lt;</span>%= @name <span class="o">%</span><span class="o">&gt;</span><span class="o">!</span>

<span class="t">Greeting</span>.<span class="k">new</span>(<span class="s">&#34;John&#34;</span>).to_s <span class="c">#=&gt; Greeting, John!</span></code></pre>

<p>Using logical statements:</p>

<pre><code><span class="c"># greeting.ecr</span>
<span class="o">&lt;</span><span class="o">%</span><span class="o">-</span> <span class="k">if</span> @name <span class="o">-</span><span class="o">%</span><span class="o">&gt;</span>
<span class="t">Greeting</span>, <span class="o">&lt;</span>%= @name <span class="o">%</span><span class="o">&gt;</span><span class="o">!</span>
<span class="o">&lt;</span><span class="o">%</span><span class="o">-</span> <span class="k">else</span> <span class="o">-</span><span class="o">%</span><span class="o">&gt;</span>
<span class="t">Greeting</span><span class="o">!</span>
<span class="o">&lt;</span><span class="o">%</span><span class="o">-</span> <span class="k">end</span> <span class="o">-</span><span class="o">%</span><span class="o">&gt;</span>

<span class="t">Greeting</span>.<span class="k">new</span>(<span class="n">nil</span>).to_s <span class="c">#=&gt; Greeting!</span></code></pre>

<p>Using loops:</p>

<pre><code><span class="k">require</span> <span class="s">&#34;ecr&#34;</span>

<span class="k">class</span> <span class="t">Greeting</span>
  @names : <span class="t">Array</span>(<span class="t">String</span>)

  <span class="k">def</span> <span class="m">initialize</span>(<span class="o">*</span>names)
   @names <span class="o">=</span> names.to_a
  <span class="k">end</span>

  <span class="t">ECR</span>.def_to_s <span class="s">&#34;greeting.ecr&#34;</span>
<span class="k">end</span>

<span class="c"># greeting.ecr</span>
<span class="o">&lt;</span><span class="o">%</span><span class="o">-</span> @names.each <span class="k">do</span> <span class="o">|</span>name<span class="o">|</span> <span class="o">-</span><span class="o">%</span><span class="o">&gt;</span>
<span class="t">Hi</span>, <span class="o">&lt;</span>%= name <span class="o">%</span><span class="o">&gt;</span><span class="o">!</span>
<span class="o">&lt;</span><span class="o">%</span><span class="o">-</span> <span class="k">end</span> <span class="o">-</span><span class="o">%</span><span class="o">&gt;</span>

<span class="t">Greeting</span>.<span class="k">new</span>(<span class="s">&#34;John&#34;</span>, <span class="s">&#34;Zoe&#34;</span>, <span class="s">&#34;Ben&#34;</span>).to_s
<span class="c">#=&gt; Hi, John!</span>
<span class="c">#=&gt; Hi, Zoe!</span>
<span class="c">#=&gt; Hi, Ben!</span></code></pre>

<p>Likewise, other Crystal logic can be implemented in ECR text.</p>














  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/d1f8c42f82d3e6491cb7b3b536984c19a51b94ba/src/ecr.cr#L73" target="_blank">ecr.cr</a>
    
    <br/>
  
    
      <a href="https://github.com/crystal-lang/crystal/blob/d1f8c42f82d3e6491cb7b3b536984c19a51b94ba/src/ecr/macros.cr#L1" target="_blank">ecr/macros.cr</a>
    
    <br/>
  









  <h2>Macro Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#def_to_s%28filename%29-macro" class="signature"><strong>def_to_s</strong>(filename)</a>
        
          <div class="summary"><p>Defines a <code>to_s(io)</code> method whose body is the ECR contained in <em>filename</em>, translated to Crystal code.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#embed%28filename%2Cio_name%29-macro" class="signature"><strong>embed</strong>(filename, io_name)</a>
        
          <div class="summary"><p>Embeds an ECR file contained in <em>filename</em> into the program.</p></div>
        
      </li>
    
  </ul>



<div class="methods-inherited">
  
</div>






  <h2>Macro Detail</h2>
  
    <div class="entry-detail" id="def_to_s(filename)-macro">
      <a class="dashingAutolink" name="autolink-1426"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/macro%20def_to_s%28filename%29"></a><div class="signature">
        
        macro <strong>def_to_s</strong>(filename)

        
      </div>
      
        <div class="doc">
<p>Defines a <code>to_s(io)</code> method whose body is the ECR contained
in <em>filename</em>, translated to Crystal code.</p>

<pre><code class="language-text"># greeting.ecr
Hello &lt;%= @name %&gt;!</code></pre>

<pre><code><span class="k">require</span> <span class="s">&#34;ecr/macros&#34;</span>

<span class="k">class</span> <span class="t">Greeting</span>
  <span class="k">def</span> <span class="m">initialize</span>(@name : <span class="t">String</span>)
  <span class="k">end</span>

  <span class="t">ECR</span>.def_to_s <span class="s">&#34;greeting.ecr&#34;</span>
<span class="k">end</span>

<span class="t">Greeting</span>.<span class="k">new</span>(<span class="s">&#34;World&#34;</span>).to_s <span class="c"># =&gt; &#34;Hello World!&#34;</span></code></pre>

<p>The macro basically translates the text inside the given file
to Crystal code that appends to the IO:</p>

<pre><code><span class="k">class</span> <span class="t">Greeting</span>
  <span class="k">def</span> <span class="m">to_s</span>(io)
    io <span class="o">&lt;&lt;</span> <span class="s">&#34;Hello &#34;</span>
    io <span class="o">&lt;&lt;</span> @name
    io <span class="o">&lt;&lt;</span> <span class="s">&#34;!&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/d1f8c42f82d3e6491cb7b3b536984c19a51b94ba/src/ecr/macros.cr#L35" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="embed(filename,io_name)-macro">
      <a class="dashingAutolink" name="autolink-1427"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/macro%20embed%28filename%2C%20io_name%29"></a><div class="signature">
        
        macro <strong>embed</strong>(filename, io_name)

        
      </div>
      
        <div class="doc">
<p>Embeds an ECR file contained in <em>filename</em> into the program.</p>

<p>The generated code is the result of translating the contents of
the ECR file to Crystal, a program that appends to the IO
with the given <em>io_name</em>.</p>

<pre><code class="language-text"># greeting.ecr
Hello &lt;%= name %&gt;!</code></pre>

<pre><code><span class="k">require</span> <span class="s">&#34;ecr/macros&#34;</span>

name <span class="o">=</span> <span class="s">&#34;World&#34;</span>

io <span class="o">=</span> <span class="t">IO</span><span class="t">::</span><span class="t">Memory</span>.<span class="k">new</span>
<span class="t">ECR</span>.embed <span class="s">&#34;greeting.ecr&#34;</span>, io
io.to_s <span class="c"># =&gt; &#34;Hello World!&#34;</span></code></pre>

<p>The <code><a href="ECR.html#embed%28filename%2Cio_name%29-macro">ECR.embed</a></code> line basically generates this:</p>

<pre><code>io <span class="o">&lt;&lt;</span> <span class="s">&#34;Hello &#34;</span>
io <span class="o">&lt;&lt;</span> name
io <span class="o">&lt;&lt;</span> <span class="s">&#34;!&#34;</span></code></pre>
</div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/crystal-lang/crystal/blob/d1f8c42f82d3e6491cb7b3b536984c19a51b94ba/src/ecr/macros.cr#L69" target="_blank">View source</a>]
        
      </div>
    </div>
  


</div>



</body></html>